{"version":3,"file":"resultgroups.min.js","sources":["../src/resultgroups.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle expand/collapse functionality for grouped search results\n *\n * @module     mod_coursesearch/resultgroups\n * @copyright  2025 Yurii Lysak\n * @license    http://www.gnu.org/licenses/gpl-3.0.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n    'use strict';\n\n    /**\n     * Toggle a result group's expanded/collapsed state\n     *\n     * @param {HTMLElement} groupElement The group container element\n     * @param {boolean} expand Whether to expand (true) or collapse (false)\n     */\n    function toggleGroup(groupElement, expand) {\n        const header = groupElement.querySelector('.coursesearch-group-header');\n        const matches = groupElement.querySelector('.coursesearch-group-matches');\n        const toggle = groupElement.querySelector('.coursesearch-group-toggle');\n        const icon = toggle ? toggle.querySelector('.icon') : null;\n\n        if (!header || !matches) {\n            return;\n        }\n\n        const isExpanded = !groupElement.classList.contains('coursesearch-group-collapsed');\n\n        if (expand === undefined) {\n            expand = !isExpanded;\n        }\n\n        if (expand) {\n            // Expand the group.\n            groupElement.classList.remove('coursesearch-group-collapsed');\n            groupElement.classList.add('coursesearch-group-expanded');\n            header.setAttribute('aria-expanded', 'true');\n            matches.setAttribute('aria-hidden', 'false');\n            if (icon) {\n                icon.classList.remove('fa-chevron-down');\n                icon.classList.add('fa-chevron-up');\n            }\n            if (toggle) {\n                toggle.setAttribute('aria-label', toggle.dataset.collapseLabel || 'Collapse matches');\n            }\n        } else {\n            // Collapse the group.\n            groupElement.classList.remove('coursesearch-group-expanded');\n            groupElement.classList.add('coursesearch-group-collapsed');\n            header.setAttribute('aria-expanded', 'false');\n            matches.setAttribute('aria-hidden', 'true');\n            if (icon) {\n                icon.classList.remove('fa-chevron-up');\n                icon.classList.add('fa-chevron-down');\n            }\n            if (toggle) {\n                toggle.setAttribute('aria-label', toggle.dataset.expandLabel || 'Expand matches');\n            }\n        }\n    }\n\n    /**\n     * Handle click on group header or toggle button\n     *\n     * @param {Event} event The click event\n     */\n    function handleGroupToggle(event) {\n        const target = event.target;\n        const groupElement = target.closest('.coursesearch-result-group');\n\n        if (!groupElement) {\n            return;\n        }\n\n        // Don't toggle if clicking on a link inside the header.\n        if (target.closest('a')) {\n            return;\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        toggleGroup(groupElement);\n    }\n\n    /**\n     * Handle keyboard events on group header or activity name span\n     *\n     * @param {Event} event The keyboard event\n     */\n    function handleGroupKeydown(event) {\n        if (event.key === 'Enter' || event.key === ' ') {\n            // Don't toggle if the target is a link.\n            if (event.target.tagName === 'A') {\n                return;\n            }\n            event.preventDefault();\n            const groupElement = event.target.closest('.coursesearch-result-group');\n            if (groupElement) {\n                toggleGroup(groupElement);\n            }\n        }\n    }\n\n    /**\n     * Attach event handlers to all result groups\n     */\n    function attachHandlers() {\n        // Find all result groups.\n        const groups = document.querySelectorAll('.coursesearch-result-group');\n\n        groups.forEach(function(group) {\n            // Skip if already has handlers.\n            if (group.dataset.coursesearchGroupHandler) {\n                return;\n            }\n            group.dataset.coursesearchGroupHandler = 'true';\n\n            const header = group.querySelector('.coursesearch-group-header');\n            const toggle = group.querySelector('.coursesearch-group-toggle');\n\n            if (header) {\n                // Click handler for header.\n                header.addEventListener('click', handleGroupToggle);\n\n                // Keyboard handler for header.\n                header.addEventListener('keydown', handleGroupKeydown);\n            }\n\n            // Also handle keyboard events on the activity name span (when no URL).\n            const activityNameSpan = group.querySelector('.coursesearch-group-activity-name');\n            if (activityNameSpan) {\n                activityNameSpan.addEventListener('keydown', handleGroupKeydown);\n            }\n\n            if (toggle) {\n                // Click handler for toggle button.\n                toggle.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    toggleGroup(group);\n                });\n            }\n        });\n    }\n\n    return {\n        /**\n         * Initialize expand/collapse handlers for search result groups\n         */\n        init: function() {\n            // Attach immediately if DOM is ready, otherwise wait.\n            if (document.readyState === 'loading') {\n                document.addEventListener('DOMContentLoaded', attachHandlers);\n            } else {\n                attachHandlers();\n            }\n        }\n    };\n});\n\n"],"names":["define","toggleGroup","groupElement","expand","header","querySelector","matches","toggle","icon","isExpanded","classList","contains","undefined","remove","add","setAttribute","dataset","collapseLabel","expandLabel","handleGroupToggle","event","target","closest","preventDefault","stopPropagation","handleGroupKeydown","key","tagName","attachHandlers","document","querySelectorAll","forEach","group","coursesearchGroupHandler","addEventListener","activityNameSpan","e","init","readyState"],"mappings":";;;;;;;AAuBAA,uCAAO,IAAI,oBASEC,YAAYC,aAAcC,cACzBC,OAASF,aAAaG,cAAc,8BACpCC,QAAUJ,aAAaG,cAAc,+BACrCE,OAASL,aAAaG,cAAc,8BACpCG,KAAOD,OAASA,OAAOF,cAAc,SAAW,SAEjDD,SAAWE,qBAIVG,YAAcP,aAAaQ,UAAUC,SAAS,qCAErCC,IAAXT,SACAA,QAAUM,YAGVN,QAEAD,aAAaQ,UAAUG,OAAO,gCAC9BX,aAAaQ,UAAUI,IAAI,+BAC3BV,OAAOW,aAAa,gBAAiB,QACrCT,QAAQS,aAAa,cAAe,SAChCP,OACAA,KAAKE,UAAUG,OAAO,mBACtBL,KAAKE,UAAUI,IAAI,kBAEnBP,QACAA,OAAOQ,aAAa,aAAcR,OAAOS,QAAQC,eAAiB,sBAItEf,aAAaQ,UAAUG,OAAO,+BAC9BX,aAAaQ,UAAUI,IAAI,gCAC3BV,OAAOW,aAAa,gBAAiB,SACrCT,QAAQS,aAAa,cAAe,QAChCP,OACAA,KAAKE,UAAUG,OAAO,iBACtBL,KAAKE,UAAUI,IAAI,oBAEnBP,QACAA,OAAOQ,aAAa,aAAcR,OAAOS,QAAQE,aAAe,4BAUnEC,kBAAkBC,aACjBC,OAASD,MAAMC,OACfnB,aAAemB,OAAOC,QAAQ,8BAE/BpB,eAKDmB,OAAOC,QAAQ,OAInBF,MAAMG,iBACNH,MAAMI,kBAENvB,YAAYC,yBAQPuB,mBAAmBL,UACN,UAAdA,MAAMM,KAAiC,MAAdN,MAAMM,IAAa,IAEf,MAAzBN,MAAMC,OAAOM,eAGjBP,MAAMG,uBACArB,aAAekB,MAAMC,OAAOC,QAAQ,8BACtCpB,cACAD,YAAYC,wBAQf0B,iBAEUC,SAASC,iBAAiB,8BAElCC,SAAQ,SAASC,UAEhBA,MAAMhB,QAAQiB,gCAGlBD,MAAMhB,QAAQiB,yBAA2B,aAEnC7B,OAAS4B,MAAM3B,cAAc,8BAC7BE,OAASyB,MAAM3B,cAAc,8BAE/BD,SAEAA,OAAO8B,iBAAiB,QAASf,mBAGjCf,OAAO8B,iBAAiB,UAAWT,2BAIjCU,iBAAmBH,MAAM3B,cAAc,qCACzC8B,kBACAA,iBAAiBD,iBAAiB,UAAWT,oBAG7ClB,QAEAA,OAAO2B,iBAAiB,SAAS,SAASE,GACtCA,EAAEb,iBACFa,EAAEZ,kBACFvB,YAAY+B,mBAMrB,CAIHK,KAAM,WAE0B,YAAxBR,SAASS,WACTT,SAASK,iBAAiB,mBAAoBN,gBAE9CA"}