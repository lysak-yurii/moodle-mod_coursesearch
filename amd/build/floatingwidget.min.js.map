{"version":3,"file":"floatingwidget.min.js","sources":["../src/floatingwidget.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Floating widget module for course search.\n *\n * @module     mod_coursesearch/floatingwidget\n * @copyright  2025\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n    'use strict';\n\n    /**\n     * Initialize the floating widget.\n     */\n    function init() {\n        const widget = document.getElementById('coursesearch-floating-widget');\n        if (!widget) {\n            return;\n        }\n\n        const toggle = widget.querySelector('.coursesearch-floating-widget-toggle');\n        const close = widget.querySelector('.coursesearch-floating-widget-close');\n        const input = widget.querySelector('.coursesearch-floating-widget-input');\n\n        // Toggle widget on click.\n        if (toggle) {\n            toggle.addEventListener('click', function() {\n                toggleWidget(widget);\n            });\n\n            // Support keyboard navigation.\n            toggle.addEventListener('keydown', function(e) {\n                if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault();\n                    toggleWidget(widget);\n                }\n            });\n        }\n\n        // Close widget on close button click.\n        if (close) {\n            close.addEventListener('click', function() {\n                collapseWidget(widget);\n            });\n        }\n\n        // Focus input when widget is expanded.\n        const observer = new MutationObserver(function(mutations) {\n            mutations.forEach(function(mutation) {\n                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n                    if (!widget.classList.contains('coursesearch-floating-widget-collapsed')) {\n                        // Widget is expanded, focus the input.\n                        if (input) {\n                            setTimeout(function() {\n                                input.focus();\n                            }, 100);\n                        }\n                    }\n                }\n            });\n        });\n\n        observer.observe(widget, {\n            attributes: true,\n            attributeFilter: ['class']\n        });\n\n        // Close widget when clicking outside.\n        document.addEventListener('click', function(e) {\n            if (!widget.contains(e.target) && !widget.classList.contains('coursesearch-floating-widget-collapsed')) {\n                collapseWidget(widget);\n            }\n        });\n    }\n\n    /**\n     * Toggle widget expanded/collapsed state.\n     *\n     * @param {HTMLElement} widget The widget element.\n     */\n    function toggleWidget(widget) {\n        if (widget.classList.contains('coursesearch-floating-widget-collapsed')) {\n            expandWidget(widget);\n        } else {\n            collapseWidget(widget);\n        }\n    }\n\n    /**\n     * Expand the widget.\n     *\n     * @param {HTMLElement} widget The widget element.\n     */\n    function expandWidget(widget) {\n        widget.classList.remove('coursesearch-floating-widget-collapsed');\n        const toggle = widget.querySelector('.coursesearch-floating-widget-toggle');\n        if (toggle) {\n            toggle.setAttribute('aria-expanded', 'true');\n        }\n    }\n\n    /**\n     * Collapse the widget.\n     *\n     * @param {HTMLElement} widget The widget element.\n     */\n    function collapseWidget(widget) {\n        widget.classList.add('coursesearch-floating-widget-collapsed');\n        const toggle = widget.querySelector('.coursesearch-floating-widget-toggle');\n        if (toggle) {\n            toggle.setAttribute('aria-expanded', 'false');\n        }\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","toggleWidget","widget","classList","contains","remove","toggle","querySelector","setAttribute","expandWidget","collapseWidget","add","init","document","getElementById","close","input","addEventListener","e","key","preventDefault","MutationObserver","mutations","forEach","mutation","type","attributeName","setTimeout","focus","observe","attributes","attributeFilter","target"],"mappings":";;;;;;;AAuBAA,yCAAO,IAAI,oBAwEEC,aAAaC,QACdA,OAAOC,UAAUC,SAAS,mDAYZF,QAClBA,OAAOC,UAAUE,OAAO,gDAClBC,OAASJ,OAAOK,cAAc,wCAChCD,QACAA,OAAOE,aAAa,gBAAiB,QAfrCC,CAAaP,QAEbQ,eAAeR,iBAsBdQ,eAAeR,QACpBA,OAAOC,UAAUQ,IAAI,gDACfL,OAASJ,OAAOK,cAAc,wCAChCD,QACAA,OAAOE,aAAa,gBAAiB,eAItC,CACHI,sBApGMV,OAASW,SAASC,eAAe,oCAClCZ,oBAICI,OAASJ,OAAOK,cAAc,wCAC9BQ,MAAQb,OAAOK,cAAc,uCAC7BS,MAAQd,OAAOK,cAAc,uCAG/BD,SACAA,OAAOW,iBAAiB,SAAS,WAC7BhB,aAAaC,WAIjBI,OAAOW,iBAAiB,WAAW,SAASC,GAC1B,UAAVA,EAAEC,KAA6B,MAAVD,EAAEC,MACvBD,EAAEE,iBACFnB,aAAaC,aAMrBa,OACAA,MAAME,iBAAiB,SAAS,WAC5BP,eAAeR,WAKN,IAAImB,kBAAiB,SAASC,WAC3CA,UAAUC,SAAQ,SAASC,UACD,eAAlBA,SAASC,MAAoD,UAA3BD,SAASE,gBACtCxB,OAAOC,UAAUC,SAAS,2CAEvBY,OACAW,YAAW,WACPX,MAAMY,UACP,YAOdC,QAAQ3B,OAAQ,CACrB4B,YAAY,EACZC,gBAAiB,CAAC,WAItBlB,SAASI,iBAAiB,SAAS,SAASC,GACnChB,OAAOE,SAASc,EAAEc,SAAY9B,OAAOC,UAAUC,SAAS,2CACzDM,eAAeR"}